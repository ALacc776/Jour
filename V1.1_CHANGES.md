# DayLog v1.1 - Changes

Version 1.1 adds dark mode support, theme switcher, and fixes the confetti animation trigger bug.

## New Features

### Theme System
Created ThemeManager.swift to manage app-wide theme preferences. Four themes are available: System (auto), Light, Dark, and Sepia (warm/nostalgic). Theme preference is saved to UserDefaults and available throughout the app via environment object.

### Theme Switcher UI
Added to Menu under new Appearance section. Users can choose between System (matches device), Light (bright and clean), Dark (easy on the eyes), and Sepia (warm and nostalgic). Each theme has an icon and description.

### Sepia Theme Colors
Uses warm beige background (#F2EBDB), lighter cream card background (#FAF5EB), dark brown text (#33261A), medium brown secondary text (#665A4D), and warmer orange accent (#D98033). Designed for a nostalgic, journal-like feel.

## Bug Fixes

### Confetti Animation Fix
Fixed confetti triggering every time user switched tabs. The problem was that confetti counter persisted across view lifecycles, and animation showed whenever counter was greater than 0, not just on changes. View recreation triggered unwanted animations.

Solution: Added isAnimating boolean flag and lastCounter tracking to detect actual new saves. Animation only shows during active animation (2-second window) and auto-stops after 2 seconds. This prevents retriggering on tab switches.

Modified file: Jour/Components/ConfettiView.swift

### Calendar View Dark Mode
Calendar picker was forced to light mode, making it invisible in dark mode. Fixed by removing .colorScheme(.light) modifier, allowing automatic adaptation.

Modified file: Jour/Views/CalendarView.swift (line 36 removed)

## Implementation Details

### Files Created
Jour/Managers/ThemeManager.swift
- ThemeManager class (ObservableObject)
- AppTheme enum (System, Light, Dark, Sepia)
- ThemeColors struct (color palettes for each theme)
- UserDefaults persistence

### Files Modified

Jour/JourApp.swift
- Added @StateObject ThemeManager
- Added .environmentObject(themeManager)
- Added .preferredColorScheme(themeManager.colorScheme())
- Theme applied at root level

Jour/Views/MenuView.swift
- Added @EnvironmentObject ThemeManager
- Added Appearance section with theme picker
- Updated version to 1.1.0
- Added preview environment object

Jour/Views/CalendarView.swift
- Removed forced light mode
- Calendar now adapts to theme

Jour/Components/ConfettiView.swift
- Fixed trigger logic
- Added animation state management
- Added 2-second auto-stop timer
- Improved particle lifecycle

## Technical Notes

### Theme System Flow
JourApp.swift creates ThemeManager as @StateObject, provides it via .environmentObject(), and applies it via .preferredColorScheme(). MenuView.swift accesses ThemeManager as @EnvironmentObject and provides theme picker that updates currentTheme. All views automatically receive theme via environment and colors adapt via semantic UIColors.

### Confetti System Flow
TodayView maintains confettiCounter as @State, increments on save, and passes to .confetti() modifier. ConfettiModifier watches counter changes, sets isAnimating to true on new save, shows 20 particles, and sets isAnimating to false after 2 seconds. ConfettiParticle animates on appear without onChange.

## Performance
Theme changes use @Published for efficient updates. Confetti auto-stops to prevent memory leaks. Semantic colors minimize custom color logic. Theme preferences are lazy loaded.

## Testing Checklist

Theme System:
- Switch between all 4 themes
- Verify System theme follows device setting
- Check theme persists after app restart
- Verify all views adapt correctly
- Test calendar visibility in dark mode
- Verify sepia theme colors

Confetti Fix:
- Verify confetti shows on new entry
- Verify confetti shows on photo entry
- Verify confetti does NOT show on tab switch
- Verify confetti does NOT show on app reopen
- Verify confetti stops after 2 seconds
- Test multiple rapid saves

Visual Verification:
- All text readable in all themes
- Buttons visible in all themes
- Calendar readable in dark mode
- Cards have proper contrast
- Icons visible in all themes

## Known Issues

Sepia theme currently uses light mode as base with custom colors. Some system components may not match perfectly. Consider this experimental.

Theme switching requires iOS to redraw entire UI, which may cause brief flash. This is normal iOS behavior.

## Version Info
Version: 1.1.0
Compatibility: iOS 16.0+
Breaking Changes: None

## Migration

Users: No action required. Theme defaults to System. All existing data preserved. Preferences automatically saved.

Developers: ThemeManager now required environment object. Add .environmentObject(themeManager) to previews. Use semantic colors for new UI elements.
